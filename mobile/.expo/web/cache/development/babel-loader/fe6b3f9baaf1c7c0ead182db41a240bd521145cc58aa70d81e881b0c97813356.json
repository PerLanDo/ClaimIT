{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nfunction ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nimport React, { createContext, useContext, useEffect, useState } from 'react';\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nimport { api } from \"../services/api\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nvar AuthContext = createContext(undefined);\nexport var useAuth = function useAuth() {\n  var context = useContext(AuthContext);\n  if (context === undefined) {\n    throw new Error('useAuth must be used within an AuthProvider');\n  }\n  return context;\n};\nexport var AuthProvider = function AuthProvider(_ref) {\n  var children = _ref.children;\n  var _useState = useState(null),\n    _useState2 = _slicedToArray(_useState, 2),\n    user = _useState2[0],\n    setUser = _useState2[1];\n  var _useState3 = useState(true),\n    _useState4 = _slicedToArray(_useState3, 2),\n    isLoading = _useState4[0],\n    setIsLoading = _useState4[1];\n  useEffect(function () {\n    loadStoredAuth();\n  }, []);\n  var loadStoredAuth = function () {\n    var _ref2 = _asyncToGenerator(function* () {\n      try {\n        var token = yield AsyncStorage.getItem('auth_token');\n        if (token) {\n          api.defaults.headers.common['Authorization'] = `Bearer ${token}`;\n          var response = yield api.get('/auth/me');\n          setUser(response.data);\n        }\n      } catch (error) {\n        console.error('Failed to load stored auth:', error);\n        yield AsyncStorage.removeItem('auth_token');\n        delete api.defaults.headers.common['Authorization'];\n      } finally {\n        setIsLoading(false);\n      }\n    });\n    return function loadStoredAuth() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n  var login = function () {\n    var _ref3 = _asyncToGenerator(function* (email, role) {\n      try {\n        var response = yield api.post('/auth/login', {\n          email: email,\n          role: role\n        });\n        var _response$data = response.data,\n          token = _response$data.token,\n          userData = _response$data.user;\n        yield AsyncStorage.setItem('auth_token', token);\n        api.defaults.headers.common['Authorization'] = `Bearer ${token}`;\n        setUser(userData);\n      } catch (error) {\n        var _error$response, _error$response$data;\n        console.error('Login error:', error);\n        throw new Error(((_error$response = error.response) == null ? void 0 : (_error$response$data = _error$response.data) == null ? void 0 : _error$response$data.error) || 'Login failed');\n      }\n    });\n    return function login(_x, _x2) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n  var register = function () {\n    var _ref4 = _asyncToGenerator(function* (email, role, fullName, studentId, department) {\n      try {\n        var response = yield api.post('/auth/register', {\n          email: email,\n          role: role,\n          fullName: fullName,\n          studentId: studentId,\n          department: department\n        });\n        var _response$data2 = response.data,\n          token = _response$data2.token,\n          userData = _response$data2.user;\n        yield AsyncStorage.setItem('auth_token', token);\n        api.defaults.headers.common['Authorization'] = `Bearer ${token}`;\n        setUser(userData);\n      } catch (error) {\n        var _error$response2, _error$response2$data;\n        console.error('Registration error:', error);\n        throw new Error(((_error$response2 = error.response) == null ? void 0 : (_error$response2$data = _error$response2.data) == null ? void 0 : _error$response2$data.error) || 'Registration failed');\n      }\n    });\n    return function register(_x3, _x4, _x5, _x6, _x7) {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n  var logout = function () {\n    var _ref5 = _asyncToGenerator(function* () {\n      try {\n        yield AsyncStorage.removeItem('auth_token');\n        delete api.defaults.headers.common['Authorization'];\n        setUser(null);\n      } catch (error) {\n        console.error('Logout error:', error);\n      }\n    });\n    return function logout() {\n      return _ref5.apply(this, arguments);\n    };\n  }();\n  var updateUser = function updateUser(userData) {\n    if (user) {\n      setUser(_objectSpread(_objectSpread({}, user), userData));\n    }\n  };\n  var value = {\n    user: user,\n    isLoading: isLoading,\n    login: login,\n    register: register,\n    logout: logout,\n    updateUser: updateUser\n  };\n  return _jsx(AuthContext.Provider, {\n    value: value,\n    children: children\n  });\n};","map":{"version":3,"names":["React","createContext","useContext","useEffect","useState","AsyncStorage","api","jsx","_jsx","AuthContext","undefined","useAuth","context","Error","AuthProvider","_ref","children","_useState","_useState2","_slicedToArray","user","setUser","_useState3","_useState4","isLoading","setIsLoading","loadStoredAuth","_ref2","_asyncToGenerator","token","getItem","defaults","headers","common","response","get","data","error","console","removeItem","apply","arguments","login","_ref3","email","role","post","_response$data","userData","setItem","_error$response","_error$response$data","_x","_x2","register","_ref4","fullName","studentId","department","_response$data2","_error$response2","_error$response2$data","_x3","_x4","_x5","_x6","_x7","logout","_ref5","updateUser","_objectSpread","value","Provider"],"sources":["C:/Users/Asus/Desktop/Programming/ClaimIT/ClaimIT/mobile/src/context/AuthContext.tsx"],"sourcesContent":["import React, { createContext, useContext, useEffect, useState } from 'react';\r\nimport AsyncStorage from '@react-native-async-storage/async-storage';\r\nimport { api } from '../services/api';\r\n\r\nexport interface User {\r\n  id: string;\r\n  email: string;\r\n  role: 'student' | 'staff' | 'teacher' | 'admin';\r\n  fullName: string;\r\n  studentId?: string;\r\n  department?: string;\r\n  phone?: string;\r\n  address?: string;\r\n  avatar?: string;\r\n  points: number;\r\n}\r\n\r\ninterface AuthContextType {\r\n  user: User | null;\r\n  isLoading: boolean;\r\n  login: (email: string, role: string) => Promise<void>;\r\n  register: (email: string, role: string, fullName: string, studentId?: string, department?: string) => Promise<void>;\r\n  logout: () => Promise<void>;\r\n  updateUser: (userData: Partial<User>) => void;\r\n}\r\n\r\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\r\n\r\nexport const useAuth = () => {\r\n  const context = useContext(AuthContext);\r\n  if (context === undefined) {\r\n    throw new Error('useAuth must be used within an AuthProvider');\r\n  }\r\n  return context;\r\n};\r\n\r\ninterface AuthProviderProps {\r\n  children: React.ReactNode;\r\n}\r\n\r\nexport const AuthProvider: React.FC<AuthProviderProps> = ({ children }) => {\r\n  const [user, setUser] = useState<User | null>(null);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    loadStoredAuth();\r\n  }, []);\r\n\r\n  const loadStoredAuth = async () => {\r\n    try {\r\n      const token = await AsyncStorage.getItem('auth_token');\r\n      if (token) {\r\n        api.defaults.headers.common['Authorization'] = `Bearer ${token}`;\r\n        \r\n        // Verify token and get user data\r\n        const response = await api.get('/auth/me');\r\n        setUser(response.data);\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to load stored auth:', error);\r\n      await AsyncStorage.removeItem('auth_token');\r\n      delete api.defaults.headers.common['Authorization'];\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const login = async (email: string, role: string) => {\r\n    try {\r\n      const response = await api.post('/auth/login', {\r\n        email,\r\n        role,\r\n      });\r\n\r\n      const { token, user: userData } = response.data;\r\n      \r\n      // Store token\r\n      await AsyncStorage.setItem('auth_token', token);\r\n      api.defaults.headers.common['Authorization'] = `Bearer ${token}`;\r\n      \r\n      setUser(userData);\r\n    } catch (error: any) {\r\n      console.error('Login error:', error);\r\n      throw new Error(error.response?.data?.error || 'Login failed');\r\n    }\r\n  };\r\n\r\n  const register = async (\r\n    email: string,\r\n    role: string,\r\n    fullName: string,\r\n    studentId?: string,\r\n    department?: string\r\n  ) => {\r\n    try {\r\n      const response = await api.post('/auth/register', {\r\n        email,\r\n        role,\r\n        fullName,\r\n        studentId,\r\n        department,\r\n      });\r\n\r\n      const { token, user: userData } = response.data;\r\n      \r\n      // Store token\r\n      await AsyncStorage.setItem('auth_token', token);\r\n      api.defaults.headers.common['Authorization'] = `Bearer ${token}`;\r\n      \r\n      setUser(userData);\r\n    } catch (error: any) {\r\n      console.error('Registration error:', error);\r\n      throw new Error(error.response?.data?.error || 'Registration failed');\r\n    }\r\n  };\r\n\r\n  const logout = async () => {\r\n    try {\r\n      await AsyncStorage.removeItem('auth_token');\r\n      delete api.defaults.headers.common['Authorization'];\r\n      setUser(null);\r\n    } catch (error) {\r\n      console.error('Logout error:', error);\r\n    }\r\n  };\r\n\r\n  const updateUser = (userData: Partial<User>) => {\r\n    if (user) {\r\n      setUser({ ...user, ...userData });\r\n    }\r\n  };\r\n\r\n  const value: AuthContextType = {\r\n    user,\r\n    isLoading,\r\n    login,\r\n    register,\r\n    logout,\r\n    updateUser,\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider value={value}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}